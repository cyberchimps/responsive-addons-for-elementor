class RaelTocHandler extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{body:".rael-toc__body",expandButton:".rael-toc__toggle-button--expand",headerTitle:".rael-toc__header-title",collapseButton:".rael-toc__toggle-button--collapse",postContentContainer:'.elementor:not([data-elementor-type="header"]):not([data-elementor-type="footer"]):not([data-elementor-type="popup"])',widgetContainer:".elementor-widget-rael-table-of-contents"},classes:{activeItem:"elementor-item-active",firstLevelListItem:"rael-toc__top-level",listTextWrapper:"rael-toc__list-item-text-wrapper",listWrapper:"rael-toc__list-wrapper",listItem:"rael-toc__list-item",listItemText:"rael-toc__list-item-text",collapsed:"rael-toc--collapsed",headingAnchor:"rael-toc__heading-anchor",anchor:"elementor-menu-anchor"},listTagWrapper:"numbers"===this.getElementSettings().rael_marker_view?"ol":"ul"}}getDefaultElements(){var e=this.getSettings();return{$tocBody:this.$element.find(e.selectors.body),$listItems:this.$element.find("."+e.classes.listItem),$widgetContainer:this.$element.find(e.selectors.widgetContainer),$expandButton:this.$element.find(e.selectors.expandButton),$collapseButton:this.$element.find(e.selectors.collapseButton),$pageContainer:this.getContainer()}}bindEvents(){var e=this,t=this.getElementSettings();t.rael_minimize_box&&(this.elements.$expandButton.on("click",function(){return e.expandBox()}),this.elements.$collapseButton.on("click",function(){return e.collapseBox()})),t.rael_collapse_subitems&&this.elements.$listItems.on("hover",function(e){return jQuery(e.target).slideToggle()})}expandBox(){var e=this.getCurrentDeviceSetting("rael_min_height");this.$element.removeClass(this.getSettings("classes.collapsed")),this.elements.$tocBody.slideDown(),this.elements.$widgetContainer.css("min-height",e.size+e.unit)}collapseBox(){this.$element.addClass(this.getSettings("classes.collapsed")),this.elements.$tocBody.slideUp(),this.elements.$widgetContainer.css("min-height","0px")}addAnchorTagsBeforeHeadings(){var e=this,t=this.getSettings("classes");this.elements.$headings.before(function(s){if(!jQuery(e.elements.$headings[s]).data("hasOwnID"))return'<span id="'.concat(t.headingAnchor,"-").concat(s,'" class="').concat(t.anchor,' "></span>')})}getHeadingLink(e,t){var s=this.elements.$headings[e].id,i=this.elements.$headings[e].closest(".elementor-widget").id,n="";return s?n=s:i&&(n=i),s||i?jQuery(this.elements.$headings[e]).data("hasOwnID",!0):n="".concat(t.headingAnchor,"-").concat(e),n}setHeadingsData(){var e=this;this.headingsData=[];var t=this.getSettings("classes");this.elements.$headings.each(function(s,i){var n=e.getHeadingLink(s,t);e.headingsData.push({tag:+i.nodeName.slice(1),text:i.textContent,anchorLink:n})})}getNestedLevel(e){for(var t=this.getSettings(),s=this.getElementSettings(),i=this.getElementSettings("rael_icon"),n="<".concat(t.listTagWrapper,' class="').concat(t.classes.listWrapper,'">');this.listItemPointer<this.headingsData.length;){var a=this.headingsData[this.listItemPointer],l=t.classes.listItemText;if(0===a.level&&(l+=" "+t.classes.firstLevelListItem),e>a.level)break;if(e===a.level){n+='<li class="'.concat(t.classes.listItem,'">'),n+='<div class="'.concat(t.classes.listTextWrapper,'">');var o='<a href="#'.concat(a.anchorLink,'" class="').concat(l,'">').concat(a.text,"</a>");"bullets"===s.rael_marker_view&&i&&(o='<i class="'.concat(i.value,'"></i>').concat(o)),n+=o,n+="</div>",this.listItemPointer++;var r=this.headingsData[this.listItemPointer];r&&e<r.level&&(n+=this.getNestedLevel(r.level)),n+="</li>"}}return n+"</".concat(t.listTagWrapper,">")}noHeadingsFound(){var e="No headings were found on this page.";return elementorFrontend.isEditMode()&&(e="No headings were found on this page."),this.elements.$tocBody.html(e)}collapseOnInit(){var e=this.getElementSettings("rael_minimized_on"),t=elementorFrontend.getCurrentDeviceMode();("tablet"===e&&"desktop"!==t||"mobile"===e&&"mobile"===t)&&this.collapseBox()}getHeadings(){var e=this.getElementSettings(),t=e.rael_headings_by_tags.join(","),s=this.getSettings("selectors"),i=e.rael_exclude_headings_by_selector;return this.elements.$pageContainer.find(t).not(s.headerTitle).filter(function(e,t){return!jQuery(t).closest(i).length})}createNestedList(){var e=this;this.headingsData.forEach(function(t,s){t.level=0;for(var i=s-1;i>=0;i--){var n=e.headingsData[i];if(n.tag<=t.tag){t.level=n.level,n.tag<t.tag&&t.level++;break}}}),this.elements.$tocBody.html(this.getNestedLevel(0))}deactivateActiveItem(e){if(!(!this.$activeItem||this.$activeItem.is(e))){var t=this.getSettings().classes;this.$activeItem.removeClass(t.activeItem),!this.$activeList||e&&this.$activeList[0].contains(e[0])||this.$activeList.slideUp()}}activateItem(e){var t,s=this.getSettings("classes");if(this.deactivateActiveItem(e),e.addClass(s.activeItem),this.$activeItem=e,this.getElementSettings("rael_collapse_subitems")){if(!(t=e.hasClass(s.firstLevelListItem)?e.parent().next():e.parents("."+s.listWrapper).eq(-2)).length){delete this.$activeList;return}this.$activeList=t,this.$activeList.stop().slideDown()}}onListItemClick(e){var t,s=this;this.itemClicked=!0,setTimeout(function(){return s.itemClicked=!1},2e3);var i=jQuery(e.target),n=i.parent().next(),a=this.getElementSettings("rael_collapse_subitems");a&&i.hasClass(this.getSettings("classes.firstLevelListItem"))&&n.is(":visible")&&(t=!0),this.activateItem(i),a&&t&&n.slideUp()}followAnchor(e,t){var s,i=this,n=e[0].hash;try{s=jQuery(decodeURIComponent(n))}catch(a){return}elementorFrontend.waypoint(s,function(n){if(!i.itemClicked){var a=s.attr("id");"down"===n?(i.viewportItems[a]=!0,i.activateItem(e)):(delete i.viewportItems[a],i.activateItem(i.$listItemTexts.eq(t-1)))}},{offset:"bottom-in-view",triggerOnce:!1}),elementorFrontend.waypoint(s,function(n){if(!i.itemClicked){var a=s.attr("id");"down"===n?(delete i.viewportItems[a],Object.keys(i.viewportItems).length&&i.activateItem(i.$listItemTexts.eq(t+1))):(i.viewportItems[a]=!0,i.activateItem(e))}},{offset:0,triggerOnce:!1})}followAnchors(){var e=this;this.$listItemTexts.each(function(t,s){return e.followAnchor(jQuery(s),t)})}createFlatList(){this.elements.$tocBody.html(this.getNestedLevel())}populateTOC(){this.listItemPointer=0,this.getElementSettings().rael_hierarchical_view?this.createNestedList():this.createFlatList(),this.$listItemTexts=this.$element.find(".rael-toc__list-item-text"),this.$listItemTexts.on("click",this.onListItemClick.bind(this)),elementorFrontend.isEditMode()||this.followAnchors()}run(){if(this.elements.$headings=this.getHeadings(),!this.elements.$headings.length)return this.noHeadingsFound();this.setHeadingsData(),elementorFrontend.isEditMode()||this.addAnchorTagsBeforeHeadings(),this.populateTOC(),this.getElementSettings("rael_minimize_box")&&this.collapseOnInit()}onInit(){for(var e=this,t=arguments.length,s=Array(t),i=0;i<t;i++)s[i]=arguments[i];super.onInit(s),this.viewportItems=[],jQuery(function(){return e.run()})}getContainer(){var e=this.getSettings(),t=this.getElementSettings();if(t.container)return jQuery(t.container);var s=this.$element.parents(".elementor");return"popup"===s.attr("data-elementor-type")?s:jQuery(e.selectors.postContentContainer)}}jQuery(window).on("elementor/frontend/init",()=>{let e=e=>{elementorFrontend.elementsHandler.addHandler(RaelTocHandler,{$element:e})};elementorFrontend.hooks.addAction("frontend/element_ready/rael-table-of-contents.default",e)});